<div class="col-lg-12">
    <% if @opportunity.stages.blank? %>
    <br>
    <div class="text-center">
        No stages created yet.
    </div>
<% else %>
    <div class="row">
        <div class="text-center">
            <small>Opportunity Stages</small>
        </div>
    </div>
    <br>

    <% @opportunity.stages.each_with_index do |stage, index| %>

    <% if index == 0 && stage.status == "Waiting" %>
    <% stage.update_attributes(current_status: true, status: "In Progress") %>
    <% end %>

    <% if (index+1) % 6 == 0 %>
    <div class="row">
        <% end %>

        <% if stage.status == "Waiting" %>
        <div class="col-lg-2 btn btn-default">
            <% elsif stage.status == "Completed" %>
            <div class="col-lg-2 btn btn-success">
                <% elsif stage.status == "In Progress" %>
                <div class="col-lg-2 btn btn-primary">
                    <% end %>

                    <span class="pull-left badge"><%= index+1 %></span>
                    <strong><%= stage.name %></strong>

                    <div class="dropdown pull-right">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="caret"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <% if stage.status == "In Progress" &&
                              @opportunity.stages.last.id == stage.id %>
                            <li><%= link_to 'Mark as Completed',
                            update_stage_status_path(@opportunity, stage),
                          remote: true, method: :get %></li>

                            <% elsif stage.status == "Waiting" %>
                            <li><%= link_to 'Mark as In Progress',
                            update_stage_status_path(@opportunity, stage),
                            remote: true, method: :get %></li>

                            <% elsif stage.status == "Completed" %>
                            <li><%= link_to 'Mark as In Progress',
                            update_stage_status_path(@opportunity, stage),
                            remote: true, method: :get %></li>
                            <% end %>

                            <li><%= link_to 'Edit stage name', '#',
                            data: { toggle: "modal", target: "#editStage-#{stage.id}"},
                            remote: true %></li>

                            <li><%= link_to 'Delete', opportunity_stage_path(@opportunity, stage),
                            method: :delete, remote: true, data: {confirm: "Are you sure?"} %></li>
                        </ul>
                    </div>

                    <br>

                    <% if stage.status == "Completed" %>
                    <small>Completed</small>
                    <br><br>
                    <% elsif stage.status == "In Progress" %>
                    <small>In Progress</small>
                    <br><br>
                    <% elsif stage.status == "Waiting" %>
                    <small>Waiting for previous stage</small>
                    <br><br>
                    <% end %>

                </div>

                <% if (index+1) % 6 == 0 %>
            </div>
            <% end %>

            <% end %>
            <!-- @opportunity.stages.each_with_index -->

            <% end %>
            <!-- @opportunity.stages.blank? -->
        </div>

        <div class="col-lg-12">
            <br>
            <div id="notice-stage"></div>
        </div>
