<div id="task_list" class="tab-pane fade in active">
    <h4>Tasks</h4>

    <% if @opportunity.tasks.blank? %>
      No tasks created yet.
    <% else %>
    <ul class="list-group">
      <li class="list-group-item">
      <div class="row">
        <div class="col-lg-5">
          <strong>Description</strong>
        </div>
        <div class="col-lg-3">
          <strong>Due date</strong>
        </div>
        <div class="col-lg-2">
          <strong>Status</strong>
        </div>
        <div class="col-lg-2">
          <strong>Action</strong>
        </div>
      </div>
    </li>
    <% @opportunity.tasks.order('created_at DESC').each do |task| %>
    <li class="list-group-item">
        <div class="row">
            <div class="col-lg-5">
                <%= task.description %>
            </div>
            <div class="col-lg-3">
              <% if task.due_date.blank? %>
              <span style="color: red;">Date not specified</span>
              <% else %>
                <% if task.due_date > Time.now %>
                <%= task.due_date.strftime('%d %b %Y') %><br>
                <small>
                  (<%= distance_of_time_in_words(task.due_date, Time.now)%> left)
                </small>
                <% else %>
                <span style="color: red;">Date overdue</span>
                <% end %>
              <% end %>
            </div>
            <div class="col-lg-2">
                <% if task.complete == false %>
                <span style="color: red;">Incomplete</span>
            <% else %>
                <span style="color: green;">Completed</span>
                <% end %>
            </div>
            <div class="col-lg-2">
              <a href="#" class="dropdown-toggle btn btn-default" data-toggle="dropdown">
                <i class="caret"></i>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <% if task.complete == false %>
                  <%= link_to 'Mark as Completed', update_task_status_path(@opportunity, task) %>
                  <% else %>
                  <%= link_to 'Mark as Incomplete', update_task_status_path(@opportunity, task) %>
                  <% end %>
                </li>
                <li><%= link_to 'Edit Task', '#', data: {toggle: "modal", target: "#act"} %></li>
                <li><%= link_to 'Delete Task', opportunity_task_path(@opportunity, task),
                method: :delete %></li>
              </ul>
            </div>
        </div>
    </li>


    <!-- Modal -->
    <div id="act" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Edit Task</h4>
          </div>
          <div class="modal-body">
            <%= simple_form_for [@opportunity, task] do |f| %>
            <%= f.input :description, placeholder: "Task description" %>
            <%= f.input :due_date %>
          </div>
          <div class="modal-footer">
            <%= f.button :submit, class: "btn btn-success" %>
            <% end %>
            <%= link_to 'Cancel', '#', class: "btn btn-default", data: {dismiss: "modal"} %>
          </div>
        </div>
      </div>
    </div>
    <% end %>

    </ul>
    <% end %>
</div>
