<h4>Events</h4>
<div id="notice-event"></div>
<% if @opportunity.events.blank? %>
No event created yet.
<% else %>
<ul class="list-group">
    <li class="list-group-item">
        <div class="row">
            <div class="col-lg-5">
                <strong>Description</strong>
            </div>
            <div class="col-lg-3">
                <strong>Due date</strong>
            </div>
            <div class="col-lg-2">
                <strong>Status</strong>
            </div>
            <div class="col-lg-2 text-center">
                <strong>Action</strong>
            </div>
        </div>
    </li>
</ul>
<% @opportunity.events.each do |event| %>
<li class="list-group-item">
    <div class="row" id="event-<%= event.id %>">
        <div class="col-lg-5">
            <%= link_to event.description.truncate(50), '#',
            data: {toggle: "modal", target: "#eventInfo-#{event.id}"} %>
        </div>
        <div class="col-lg-3">
            <% if event.event_date.blank? %>
            <span style="color: red;">Date not specified</span>
        <% else %>
            <% if event.event_date > Date.today %>
            <%= event.event_date.strftime('%d %b %Y') %><br>
            <small>
                (<%= distance_of_time_in_words(Time.now, event.event_date) %>
                left)
            </small>
            <% elsif event.event_date == Date.today %>
            <strong style="color: orange;">Today</strong><br>
            <small>(<%= Time.now.strftime('%d %b %Y') %>)</small>
        <% else %>
            <strong style="color: red;">Event passed</strong><br>
            <small>
                (<%= distance_of_time_in_words(Time.now, event.event_date) %>
                ago)
            </small>
            <% end %>
            <% end %>
        </div>
        <div class="col-lg-2">
            <% if event.complete == false %>
            <span style="color: red;">Not attend</span>
        <% else %>
            <span style="color: green;">Attended</span>
            <% end %>
        </div>
        <div class="col-lg-2 text-center">
            <a href="#" class="dropdown-toggle btn btn-default" data-toggle="dropdown">
                <i class="caret"></i>
            </a>
            <ul class="dropdown-menu">
            <li>
                <% if event.complete == false %>
                <%= link_to 'Mark as Attended', update_event_status_path(@opportunity, event),
                  remote: true %>
            <% else %>
                <%= link_to 'Mark as Not Attend', update_event_status_path(@opportunity, event),
                  remote: true %>
                <% end %>
            </li>
            <li><%= link_to 'Show', '#', data: {toggle: "modal", target: "#eventInfo-#{event.id}"}%></li>
            <li><%= link_to 'Edit Event', edit_opportunity_event_path(@opportunity, event) %></li>
            <li><%= link_to 'Delete Event', opportunity_event_path(@opportunity, event),
                method: :delete, remote: true, data: {confirm: "Are you sure?"} %></li>
        </ul>
    </div>
</div>
</li>

<%= render 'events/event_info', event: event %>

<% end %>
<% end %>
